<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Aggregate PCR replicates — aggregate_pcrs • metabaR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Aggregate PCR replicates — aggregate_pcrs"><meta property="og:description" content="Aggregate PCR replicates in a metabarlist object."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">metabaR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/metabaRF-vignette.html">Let's metabaR!</a>
    </li>
    <li>
      <a href="../articles/metabaRF-vignette_karst.html">The karst_euk dataset: sampler effect and technical reproducibility</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/metabaRfactory/metabaR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Aggregate PCR replicates</h1>
    <small class="dont-index">Source: <a href="https://github.com/metabaRfactory/metabaR/blob/HEAD/R/aggregate_pcrs.R" class="external-link"><code>R/aggregate_pcrs.R</code></a></small>
    <div class="hidden name"><code>aggregate_pcrs.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Aggregate PCR replicates in a <code>metabarlist</code> object.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">aggregate_pcrs</span><span class="op">(</span><span class="va">metabarlist</span>, replicates <span class="op">=</span> <span class="cn">NULL</span>, FUN <span class="op">=</span> <span class="va">FUN_agg_pcrs_sum</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">FUN_agg_pcrs_sum</span><span class="op">(</span><span class="va">metabarlist</span>, <span class="va">replicates</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">FUN_agg_pcrs_mean</span><span class="op">(</span><span class="va">metabarlist</span>, <span class="va">replicates</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">FUN_agg_pcrs_prob</span><span class="op">(</span><span class="va">metabarlist</span>, <span class="va">replicates</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>metabarlist</dt>
<dd><p>a <code>metabarlist</code> object</p></dd>


<dt>replicates</dt>
<dd><p>a vector containing the sample names to which each pcr
replicate belongs and within which they should be aggregated.
Default is the `sample_id` column from the `pcrs` table.</p></dd>


<dt>FUN</dt>
<dd><p>a replicate aggregation function.
Default is the sum of reads per MOTU across replicates.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A <code>metabarlist</code> where the table `reads` contains MOTU abundances aggregated according to <code>FUN</code>. The number of rows of the produced `reads` and `pcrs` tables are equal to that of the `samples` table.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The function <code>aggregate_pcrs</code> is typically used at the end of the data filtration process and aims to aggregate reads and the pcr related information at the sample level. The user is free to use their own method of aggregation, but the following are often used and therefore pre-encoded:</p>
<ul><li><p><code>FUN_agg_pcrs_sum</code>: the reads of pcr replicates are summed for each MOTU</p></li>
<li><p><code>FUN_agg_pcrs_mean</code>: the reads of pcr replicates are averaged for each MOTU.
      Results are rounded so as to obtain genuine count data</p></li>
<li><p><code>FUN_agg_pcrs_prob</code>: the probability of detection is returned for each MOTU.
      This method is often used in studies dealing with ancient DNA (e.g. Pansu et al. 2015) or diet (e.g. Deagles et al. 2019).</p></li>
</ul><p>After aggregation, the information contained in the `pcrs` table is averaged if numeric.
If none numeric, information is dereplicated if equal across replicates, or concatenated if not.</p>
    </div>
    <div id="functions">
    <h2>Functions</h2>
    
<ul><li><p><code>aggregate_pcrs</code>: Aggregate PCR replicates in a <code>metabarlist</code> object.</p></li>
<li><p><code>FUN_agg_pcrs_sum</code>: Aggregate PCR replicates in a <code>metabarlist</code> object by summing MOTUs read counts across PCR replicates.</p></li>
<li><p><code>FUN_agg_pcrs_mean</code>: Aggregate PCR replicates in a <code>metabarlist</code> object by averaging MOTUs read counts across PCR replicates</p></li>
<li><p><code>FUN_agg_pcrs_prob</code>: Aggregate PCR replicates in a <code>metabarlist</code> object by computing the probability of MOTU occurrence across PCR replicates.</p></li>
</ul></div>
    <div id="references">
    <h2>References</h2>
    <p>Deagle, B. E., Thomas, A. C., McInnes, J. C., Clarke, L. J., Vesterinen, E. J., Clare, E. L., ... &amp; Eveson, J. P. (2019). Counting with DNA in metabarcoding studies: How should we convert sequence reads to dietary data?. Molecular Ecology, 28(2), 391-406.</p>
<p>Pansu, J., Giguet-Covex, C., Ficetola, G. F., Gielly, L., Boyer, F., Zinger, L., ... &amp; Choler, P. (2015). Reconstructing long-term human impacts on plant communities: An ecological approach based on lake sediment DNA. Molecular Ecology, 24(7), 1485-1498.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="aggregate_motus.html">aggregate_motus</a></code>, <code><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></code>, <code><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></code></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Lucie Zinger, Frédéric Boyer</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">soil_euk</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## With default function (sum reads across replicates)</span></span></span>
<span class="r-in"><span><span class="va">soil_euk_ag</span> <span class="op">&lt;-</span> <span class="fu">aggregate_pcrs</span><span class="op">(</span><span class="va">soil_euk</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Some PCRs in out have a number of reads of zero in table `reads`!</span>
<span class="r-in"><span><span class="fu"><a href="summary_metabarlist.html">summary_metabarlist</a></span><span class="op">(</span><span class="va">soil_euk</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $dataset_dimension</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         n_row n_col</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> reads     384 12647</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> motus   12647    15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pcrs      384    11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> samples    64     8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $dataset_statistics</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         nb_reads nb_motus avg_reads sd_reads avg_motus sd_motus</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pcrs     3538913    12647  9215.919 10283.45  333.6849  295.440</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> samples  2797294    12382 10926.930 10346.66  489.5117  239.685</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="summary_metabarlist.html">summary_metabarlist</a></span><span class="op">(</span><span class="va">soil_euk_ag</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $dataset_dimension</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         n_row n_col</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> reads      96 12647</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> motus   12647    15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pcrs       96    11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> samples    64     8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $dataset_statistics</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         nb_reads nb_motus avg_reads sd_reads avg_motus sd_motus</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pcrs     3538913    12647  36863.68 25728.92  765.1146 585.5052</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> samples  2797294    12382  43707.72 24514.09 1115.1406 376.4573</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## With the FUN_agg_prob pre-defined function</span></span></span>
<span class="r-in"><span><span class="va">soil_euk_ag</span> <span class="op">&lt;-</span> <span class="fu">aggregate_pcrs</span><span class="op">(</span><span class="va">soil_euk</span>, FUN <span class="op">=</span> <span class="va">FUN_agg_pcrs_prob</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Some PCRs in out have a number of reads of zero in table `reads`!</span>
<span class="r-in"><span><span class="fu"><a href="summary_metabarlist.html">summary_metabarlist</a></span><span class="op">(</span><span class="va">soil_euk</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $dataset_dimension</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         n_row n_col</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> reads     384 12647</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> motus   12647    15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pcrs      384    11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> samples    64     8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $dataset_statistics</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         nb_reads nb_motus avg_reads sd_reads avg_motus sd_motus</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pcrs     3538913    12647  9215.919 10283.45  333.6849  295.440</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> samples  2797294    12382 10926.930 10346.66  489.5117  239.685</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="summary_metabarlist.html">summary_metabarlist</a></span><span class="op">(</span><span class="va">soil_euk_ag</span><span class="op">)</span> <span class="co">## output reads produced do not have much sense in this case.</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $dataset_dimension</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         n_row n_col</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> reads      96 12647</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> motus   12647    15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pcrs       96    11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> samples    64     8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $dataset_statistics</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         nb_reads nb_motus avg_reads sd_reads avg_motus sd_motus</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pcrs    32033.75    12647  333.6849 269.9321  765.1146 585.5052</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> samples 31328.75    12382  489.5117 188.7353 1115.1406 376.4573</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## With a custom function (here equivalent to FUN_agg_pcrs_sum,</span></span></span>
<span class="r-in"><span><span class="co">## i.e. summing abundances of all MOTUs across replicates)</span></span></span>
<span class="r-in"><span><span class="va">soil_euk_ag</span> <span class="op">&lt;-</span> <span class="fu">aggregate_pcrs</span><span class="op">(</span><span class="va">soil_euk</span>,</span></span>
<span class="r-in"><span>                              FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">metabarlist</span>, <span class="va">replicates</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>                                 <span class="fu"><a href="https://rdrr.io/r/base/rowsum.html" class="external-link">rowsum</a></span><span class="op">(</span><span class="va">metabarlist</span><span class="op">$</span><span class="va">reads</span>, <span class="va">replicates</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Some PCRs in out have a number of reads of zero in table `reads`!</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Lucie Zinger, Frédéric Boyer, Clément Lionnet, Anne-Sophie Benoiston.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

      </footer></div>

  


  

  </body></html>

